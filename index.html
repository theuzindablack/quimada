<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QUEIMADA: IA REFORÃ‡ADA</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: white; z-index: 100; font-size: 22px; text-shadow: 2px 2px #000; pointer-events: none; }
        #joystick { position: absolute; bottom: 30px; left: 30px; width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid #fff; }
        #stick { position: absolute; top: 20px; left: 20px; width: 40px; height: 40px; background: #fff; border-radius: 50%; }
        #btn-throw { position: absolute; bottom: 30px; right: 30px; width: 100px; height: 100px; background: #00ff00; border-radius: 50%; border: 5px solid #fff; font-weight: bold; display: none; color: #000; box-shadow: 0 0 15px #00ff00; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; color: white; flex-direction: column; }
    </style>
</head>
<body>

<div id="ui">INIMIGO AGORA BUSCA A BOLA NO FUNDO!</div>
<div id="overlay">
    <h1 id="result-text"></h1>
    <button onclick="location.reload()" style="padding:15px 30px; font-size:20px;">RECOMEÃ‡AR</button>
</div>

<div id="joystick"><div id="stick"></div></div>
<button id="btn-throw">LANÃ‡AR!</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 1));

    // CHÃƒO E LINHAS
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(60, 120), new THREE.MeshBasicMaterial({ color: 0x111 }));
    floor.rotation.x = -Math.PI/2; scene.add(floor);

    function createLine(w, h, x, z, color = 0xffffff) {
        const geo = new THREE.PlaneGeometry(w, h);
        const mat = new THREE.MeshBasicMaterial({ color: color });
        const mesh = new THREE.Mesh(geo, mat);
        mesh.rotation.x = -Math.PI/2; mesh.position.set(x, 0.2, z);
        scene.add(mesh);
    }
    createLine(60, 1.5, 0, 0, 0xff0000); // Meio
    createLine(1, 120, -30, 0); createLine(1, 120, 30, 0); // Laterais

    // PERSONAGENS
    const player = new THREE.Mesh(new THREE.BoxGeometry(5, 8, 5), new THREE.MeshBasicMaterial({ color: 0x00ff00 }));
    player.position.set(0, 4, 40); scene.add(player);

    const enemy = new THREE.Mesh(new THREE.BoxGeometry(5, 8, 5), new THREE.MeshBasicMaterial({ color: 0xff00ff }));
    enemy.position.set(0, 4, -45); scene.add(enemy);

    // BOLA
    const ball = new THREE.Mesh(new THREE.SphereGeometry(2.5, 16, 16), new THREE.MeshBasicMaterial({ color: 0xffff00 }));
    ball.position.set(0, 2.5, 15); scene.add(ball);

    // MIRA
    const laserMat = new THREE.LineBasicMaterial({ color: 0x00ff00 });
    const laserGeo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(), new THREE.Vector3()]);
    const laser = new THREE.Line(laserGeo, laserMat);
    scene.add(laser);

    let ballState = "SOLTA", owner = "NINGUEM", ballVel = new THREE.Vector3();
    let move = {x:0, z:0}, gameActive = true;

    // JOYSTICK
    window.addEventListener('touchmove', (e) => {
        if(!gameActive) return;
        const t = e.touches[0], r = document.getElementById('joystick').getBoundingClientRect();
        let dx = t.clientX - (r.left + 40), dz = t.clientY - (r.top + 40);
        const d = Math.sqrt(dx*dx + dz*dz); if(d > 30) { dx *= 30/d; dz *= 30/d; }
        document.getElementById('stick').style.transform = `translate(${dx}px, ${dz}px)`;
        move.x = dx/30; move.z = dz/30;
    });
    window.addEventListener('touchend', () => { move = {x:0, z:0}; document.getElementById('stick').style.transform = 'translate(0,0)'; });

    document.getElementById('btn-throw').onclick = () => {
        if(owner === "PLAYER") {
            ballState = "VOANDO_PLAYER"; owner = "NINGUEM";
            ballVel.set((enemy.position.x - player.position.x) * 0.22, 0, -7.5);
        }
    };

    function animate() {
        if(!gameActive) return;
        requestAnimationFrame(animate);

        // Movimento Player
        player.position.x = Math.max(-27, Math.min(27, player.position.x + move.x * 1.5));
        player.position.z = Math.max(5, Math.min(55, player.position.z + move.z * 1.5));

        // IA INIMIGO MELHORADA
        if(ballState === "SOLTA" && ball.position.z < 0) {
            // Persegue a bola agressivamente em X e Z
            const dirX = Math.sign(ball.position.x - enemy.position.x);
            const dirZ = Math.sign(ball.position.z - enemy.position.z);
            enemy.position.x += dirX * 1.3;
            enemy.position.z += dirZ * 1.3;

            // Se estiver muito perto da bola no campo dele, ele pega
            if(enemy.position.distanceTo(ball.position) < 8) {
                owner = "ENEMY"; ballState = "POSSE";
            }
        } else if (owner !== "ENEMY") {
            // Volta para posiÃ§Ã£o de guarda se nÃ£o houver bola no campo dele
            enemy.position.x += Math.sin(Date.now()*0.005) * 1.8;
            enemy.position.z += ((-45) - enemy.position.z) * 0.1;
        }
        
        // Limites estritos do inimigo (consegue ir atÃ© o fundo Z = -58)
        enemy.position.x = Math.max(-27, Math.min(27, enemy.position.x));
        enemy.position.z = Math.max(-58, Math.min(-2, enemy.position.z));

        // LÃ³gica de Posse
        if(owner === "PLAYER") {
            ball.position.set(player.position.x, 6, player.position.z - 6);
            laser.visible = true;
            laser.geometry.setFromPoints([ball.position, enemy.position]);
        } else if(owner === "ENEMY") {
            ball.position.set(enemy.position.x, 6, enemy.position.z + 6);
            laser.visible = false;
            if(Math.random() < 0.03) { 
                ballState = "VOANDO_ENEMY"; owner = "NINGUEM"; 
                ballVel.set((player.position.x - enemy.position.x)*0.16, 0, 6.5); 
            }
        } else { laser.visible = false; }

        // Bola em movimento
        if(ballState.includes("VOANDO")) {
            ball.position.add(ballVel);
            if(Math.abs(ball.position.x) > 28) ballVel.x *= -1;
            if(Math.abs(ball.position.z) > 58) { 
                ballVel.z *= -0.5; // Quica menos para parar no campo
                ballState = "SOLTA"; 
            }

            if(ballState === "VOANDO_PLAYER" && ball.position.distanceTo(enemy.position) < 6) {
                gameActive = false; document.getElementById('overlay').style.display = 'flex';
                document.getElementById('result-text').innerText = "VITÃ“RIA! ðŸŽ‰";
            }
            if(ballState === "VOANDO_ENEMY" && ball.position.distanceTo(player.position) < 6) {
                gameActive = false; document.getElementById('overlay').style.display = 'flex';
                document.getElementById('result-text').innerText = "DERROTA! ðŸ’€";
            }
        }

        // Jogador pega a bola
        if(ballState === "SOLTA" && ball.position.z > 0 && player.position.distanceTo(ball.position) < 12) {
            owner = "PLAYER"; ballState = "POSSE";
        }

        document.getElementById('btn-throw').style.display = (owner === "PLAYER") ? "block" : "none";
        camera.position.set(0, 110, 130);
        camera.lookAt(0, 0, 0);
        renderer.render(scene, camera);
    }
    animate();
</script>
</body>
</html>
